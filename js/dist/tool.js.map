{"version":3,"file":"tool.js","sources":["../src/tool.js"],"sourcesContent":["import $ from 'jquery'\nimport Toast from './toast'\n\n/**\n * ------------------------------------------------------------------------\n *  工具类\n *  @author lyc\n *  @date 2020年06月04日17:48:50\n * ------------------------------------------------------------------------\n */\nclass Tool {\n  // ----------------------------------------------------------------------\n  // 获取form数据转为Object\n  // $form 为form的JQuery对象\n  // ----------------------------------------------------------------------\n  static formData($form) {\n    if (!$form || $form.length === 0 || !$ || !$.fn) {\n      return {}\n    }\n    const array = $form.serializeArray()\n    const data = {}\n    for (const index in array) {\n      if (!Object.prototype.hasOwnProperty.call(array, index)) {\n        continue\n      }\n      const name = array[index].name\n      const value  = array[index].value || ''\n      data[name] = data[name] ? [value,\n        ...$.isArray(data[name]) ? data[name] : [data[name]]] : value\n    }\n    return data\n  }\n  // ----------------------------------------------------------------------\n  // 字符串转function\n  // ----------------------------------------------------------------------\n  static eval(value) {\n    let args\n    let fuc\n    if (!value) {\n      return fuc\n    }\n    const regval =  value.match(/\\(.*\\)/gi)\n\n    if (regval && regval instanceof Array && regval.length > 0) {\n      const JSON = window.JSON\n      const argstr =  regval.pop()\n      value = value.replace(argstr, '')\n      args = argstr.replace(/\\(|\\)/g, '').split(';')\n      args = args.filter((arg) => arg || arg === 0).map((arg) => JSON.parse(arg.replace(/'/g, '\"')))\n    }\n    try {\n      // eslint-disable-next-line no-new-func\n      fuc = new Function(`return ${value}`)()\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.log(`the value [${value}] is not function`)\n    }\n    return args ? {\n      args,\n      fuc\n    } : fuc\n  }\n\n  // ----------------------------------------------------------------------\n  // 判断是否为JSON\n  // ----------------------------------------------------------------------\n  static isJSON(value) {\n    if (!window.JSON || Object.prototype.toString.call(window.JSON) !== '[object JSON]') {\n      throw new ReferenceError('JSON is not exist in window')\n    }\n    const JSON = window.JSON\n    value = typeof value === 'string' ? value : JSON.stringify(value)\n    try {\n      value = Object.prototype.toString.call(JSON.parse(value))\n      if (value === '[object Object]' || value === '[object Array]') {\n        return true\n      }\n      return false\n    } catch (e) {\n      return false\n    }\n  }\n\n  // ----------------------------------------------------------------------\n  //  获取选中的项转为Object\n  //  dataName可为 'id' 或 ['id','name']\n  // ----------------------------------------------------------------------\n  static checkedData(dataName, one) {\n    const data = {}\n    const $chks = $(this).closest('.query-data').find('.chk:checked')\n    if (!one && (!$chks || $chks.length === 0)) {\n      Toast.warn('请选择之后进行操作')\n      return false\n    }\n    if (one && (!$chks || $chks.length !== 1)) {\n      Toast.warn('请选择一项之后进行操作')\n      return false\n    }\n    if (!dataName) {\n      dataName = 'id'\n    }\n    if ($.isArray(dataName)) {\n      for (const index in dataName) {\n        if (!Object.prototype.hasOwnProperty.call(dataName, index)) {\n          continue\n        }\n        const name = dataName[index]\n        if (typeof name !== 'string') {\n          continue\n        }\n        const attrs = $.map($chks, (element) => $(element).data(name))\n        data[name] = attrs.join(',')\n      }\n    } else if (typeof dataName === 'string') {\n      const attrs =  $.map($chks, (element) => $(element).data(dataName))\n      data[dataName] = attrs.join(',')\n    }\n    return data\n  }\n}\n\nexport default Tool\n"],"names":["Tool","formData","$form","length","$","fn","array","serializeArray","data","index","Object","prototype","hasOwnProperty","call","name","value","isArray","eval","args","fuc","regval","match","Array","JSON","window","argstr","pop","replace","split","filter","arg","map","parse","Function","error","console","log","isJSON","toString","ReferenceError","stringify","e","checkedData","dataName","one","$chks","closest","find","Toast","warn","attrs","element","join"],"mappings":"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"}