{"version":3,"file":"tool.js","sources":["../src/tool.js"],"sourcesContent":["import $ from 'jquery'\nimport Toast from './toast'\n\n/**\n * ------------------------------------------------------------------------\n *  工具类\n *  @author lyc\n *  @date 2020年06月04日17:48:50\n * ------------------------------------------------------------------------\n */\nclass Tool {\n  // ----------------------------------------------------------------------\n  // 获取form数据转为Object\n  // $form 为form的JQuery对象\n  // ----------------------------------------------------------------------\n  static formData($form) {\n    if (!$form || $form.length === 0 || !$ || !$.fn) {\n      return {}\n    }\n    const array = $form.serializeArray()\n    const data = {}\n    for (const index in array) {\n      if (!Object.prototype.hasOwnProperty.call(array, index)) {\n        continue\n      }\n      const name = array[index].name\n      const value  = array[index].value\n      data[name] = data[name] ? [...$.isArray(data[name]) ? data[name] : [data[name]], value] : value\n    }\n    return data\n  }\n\n  // ----------------------------------------------------------------------\n  // Object序列化\n  // ----------------------------------------------------------------------\n  static toSerialize(obj) {\n    let serialize = ''\n    if (!obj || !(obj instanceof Object)) {\n      return serialize\n    }\n    for (const key in obj) {\n      if (!Object.prototype.hasOwnProperty.call(obj, key)) {\n        continue\n      }\n      const data = obj[key]\n\n      if (data instanceof Array) {\n        for (const index in data) {\n          if (!Object.prototype.hasOwnProperty.call(data, index)) {\n            continue\n          }\n          const value = data[index]\n          serialize = serialize ? serialize.concat(`&${key}=${value}`) : `${key}=${value}`\n        }\n      } else if (typeof data === 'object') {\n        continue\n      } else {\n        serialize = serialize ? serialize.concat(`&${key}=${data}`) : `${key}=${data}`\n      }\n    }\n    return serialize\n  }\n\n  // ----------------------------------------------------------------------\n  // 数组数据转为Object\n  // ----------------------------------------------------------------------\n  static toObject(target, ...needs) {\n    if (!target) {\n      return {}\n    }\n    if (!(target instanceof Array)) {\n      return target\n    }\n    const data = {}\n    let flag = false\n    for (const index in target) {\n      if (!Object.prototype.hasOwnProperty.call(target, index)) {\n        continue\n      }\n      const targetData = target[index]\n      if (typeof targetData !== 'object') {\n        flag = true\n        break\n      }\n      for (const key in targetData) {\n        if (!Object.prototype.hasOwnProperty.call(targetData, key)) {\n          continue\n        }\n        if (needs && needs.length > 0 && !needs.includes(key)) {\n          continue\n        }\n        const value = targetData[key]\n        data[key] = data[key] ? [...$.isArray(data[key]) ? data[key] : [data[key]], value] : value\n      }\n    }\n    return flag ? target : data\n  }\n  // ----------------------------------------------------------------------\n  // 字符串转function\n  // ----------------------------------------------------------------------\n  static eval(value) {\n    let args\n    let fuc\n    if (!value) {\n      return fuc\n    }\n    const regval =  value.match(/\\(.*\\)/gi)\n\n    if (regval && regval instanceof Array && regval.length > 0) {\n      const JSON = window.JSON\n      const argstr =  regval.pop()\n      value = value.replace(argstr, '')\n      args = argstr.replace(/\\(|\\)/g, '').split(';')\n      args = args.filter((arg) => arg || arg === 0).map((arg) => JSON.parse(arg.replace(/'/g, '\"')))\n    }\n    try {\n      // eslint-disable-next-line no-new-func\n      fuc = new Function(`return ${value}`)()\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.log(`the value [${value}] is not function`)\n    }\n    return args ? {\n      args,\n      fuc\n    } : fuc\n  }\n\n  // ----------------------------------------------------------------------\n  // 判断是否为JSON\n  // ----------------------------------------------------------------------\n  static isJSON(value) {\n    if (!window.JSON || Object.prototype.toString.call(window.JSON) !== '[object JSON]') {\n      throw new ReferenceError('JSON is not exist in window')\n    }\n    const JSON = window.JSON\n    value = typeof value === 'string' ? value : JSON.stringify(value)\n    try {\n      value = Object.prototype.toString.call(JSON.parse(value))\n      if (value === '[object Object]' || value === '[object Array]') {\n        return true\n      }\n      return false\n    } catch (e) {\n      return false\n    }\n  }\n\n  // ----------------------------------------------------------------------\n  //  获取选中的项转为Object\n  //  dataName可为 'id' 或 ['id','name']\n  // ----------------------------------------------------------------------\n  static checkedData(dataName, one) {\n    const data = {}\n    const $chks = $(this).closest('.query-data').find('.chk:checked')\n    if (!one && (!$chks || $chks.length === 0)) {\n      Toast.warn('请选择之后进行操作')\n      return false\n    }\n    if (one && (!$chks || $chks.length !== 1)) {\n      Toast.warn('请选择一项之后进行操作')\n      return false\n    }\n    if (!dataName) {\n      dataName = 'id'\n    }\n    if ($.isArray(dataName)) {\n      for (const index in dataName) {\n        if (!Object.prototype.hasOwnProperty.call(dataName, index)) {\n          continue\n        }\n        const name = dataName[index]\n        if (typeof name !== 'string') {\n          continue\n        }\n        const attrs = $.map($chks, (element) => $(element).data(name))\n        data[name] = attrs.join(',')\n      }\n    } else if (typeof dataName === 'string') {\n      const attrs =  $.map($chks, (element) => $(element).data(dataName))\n      data[dataName] = attrs.join(',')\n    }\n    return data\n  }\n\n  // ----------------------------------------------------------------------\n  //  ztree 简单数据 转 子孙节点数据\n  // ----------------------------------------------------------------------\n  static rebliud(sNodes, key, parentKey, childKey) {\n    if (!key) {\n      key = 'id'\n    }\n    if (!parentKey) {\n      parentKey = 'pid'\n    }\n    if (!childKey) {\n      childKey = 'children'\n    }\n    const result = []\n    const tmpMap = {}\n\n    // 先把数组整理成map的形式\n    for (let i = 0, l = sNodes.length; i < l; i++) {\n      // key为 对象的\"id\"的值， value就是就该对象\n      tmpMap[sNodes[i][key]] = sNodes[i]\n    }\n\n    // 遍历，组织成子孙节点\n    for (let i = 0, l = sNodes.length; i < l; i++) {\n      // 查找当前节点的父节点是否存在，如果存在就把当前节点放入到父节点的子孙列表中\n      if (tmpMap[sNodes[i][parentKey]] && sNodes[i][key] !== sNodes[i][parentKey]) {\n        if (!tmpMap[sNodes[i][parentKey]][childKey]) {\n          tmpMap[sNodes[i][parentKey]][childKey] = []\n        }\n        tmpMap[sNodes[i][parentKey]][childKey].push(sNodes[i])\n      } else {\n        // 如果不存在就直接放入到一个新的列表中\n        result.push(sNodes[i])\n      }\n    }\n    return result\n  }\n}\n\nexport default Tool\n"],"names":["Tool","formData","$form","length","$","fn","array","serializeArray","data","index","Object","prototype","hasOwnProperty","call","name","value","isArray","toSerialize","obj","serialize","key","Array","concat","toObject","target","flag","needs","targetData","includes","eval","args","fuc","regval","match","JSON","window","argstr","pop","replace","split","filter","arg","map","parse","Function","error","console","log","isJSON","toString","ReferenceError","stringify","e","checkedData","dataName","one","$chks","closest","find","Toast","warn","attrs","element","join","rebliud","sNodes","parentKey","childKey","result","tmpMap","i","l","push"],"mappings":"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"}