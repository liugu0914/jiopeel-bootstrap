{"version":3,"file":"catalog.js","sources":["../src/catalog.js"],"sourcesContent":["/* eslint-disable consistent-return */\r\n\r\n/* eslint-disable no-undef */\r\n/* eslint-disable no-magic-numbers */\r\n/* eslint-disable guard-for-in */\r\nconst Catalog = {\r\n  rowTemplate : `<div class=\"row\">\r\n                <div class=\"col-12\">\r\n                    <div class=\"card d-block\">\r\n                        <a href=\"/p/{{id}}\">{{img}}</a>\r\n                        <div class=\"card-body bg-mode\">\r\n                             <a href=\"/p/{{id}}\"><h5 class=\"display-7 mb-2\">{{title}}</h5> </a>\r\n                            <p class=\"card-text\">{{content}}</p>\r\n                            <div class=\"row\">\r\n                                <div class=\"col-sm-7\">\r\n                                    {{label}}\r\n                                </div>\r\n                                <div class=\"col-sm-5\">\r\n                                    <div class=\"pt-1 pb-1\">\r\n                                        <p class=\"card-text text-sm-left text-md-right\">\r\n                                            <small class=\"text-muted mr-1\">分类: <span class=\"badge badge-info-lighten\">{{sortname}}</span></small>\r\n                                            <small class=\"text-muted\">|</small>\r\n                                            <small class=\"text-muted ml-1\"><i class=\"cs cs-shijian font-weight-bolder\"></i> {{time}}</small>\r\n                                        </p>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>`,\r\n  imgTemplate :'<div class=\"card-bg-img card-img-top h-img-show\" style=\"background-image: url(\\'{{cover}}\"></div>',\r\n  labelTemplate :'<div class=\"pt-1 pb-1\"><i class=\"cs cs-biaoqian\"></i>{{tags}}</div>',\r\n  tagsTemplate :'<span class=\"badge badge-warning-lighten mr-1\">{{tagName}}</span>',\r\n  init() {\r\n    Catalog.loadData()\r\n    $(window).on('resize scroll', () => {\r\n      const windowHeight = $(window).height()// 当前窗口的高度\r\n      const scrollTop = $(window).scrollTop()// 当前滚动条从上往下滚动的距离\r\n      const docHeight = $(document).height() // 当前文档的高度\r\n      // 当 滚动条距底部的距离 + 滚动条滚动的距离 >= 文档的高度 - 窗口的高度\r\n      // 换句话说：（滚动条滚动的距离 + 窗口的高度 = 文档的高度）  这个是基本的公式\r\n      if (scrollTop + windowHeight >= docHeight) {\r\n        if ($('#catalog-data-loading').length !== 0) {\r\n          return\r\n        }\r\n        Catalog.addLoading()\r\n        setTimeout(Catalog.loadData, 200)\r\n      }\r\n    })\r\n  },\r\n  addLoading(text) {\r\n    text = text ? text : '加载中&hellip;'\r\n    const loadingTemplate = `<div id=\"catalog-data-loading\" class=\"text-muted text-center font-13\">${text}</div>`\r\n    const $data = $('#catalog-data')\r\n    const $loading = $('#catalog-data-loading')\r\n    if ($loading.length === 0) {\r\n      $(loadingTemplate).appendTo($data).offset()\r\n    }\r\n  },\r\n  endLoading(has, text) {\r\n    const $loading = $('#catalog-data-loading')\r\n    if (has) {\r\n      $loading.remove()\r\n    } else {\r\n      if ($loading.length === 0) {\r\n        Catalog.addLoading(text)\r\n      }\r\n      $loading.text(text)\r\n    }\r\n  },\r\n  loadData() {\r\n    const data = $('#catalog-data').data()\r\n    let pageNum = data.pageNum\r\n    const pages = data.pages\r\n    if (pageNum !== 0 && !pageNum) {\r\n      pageNum = -1\r\n    }\r\n    if (pages && pageNum === pages - 1) {\r\n      return Catalog.endLoading(false, '———— The End ————')\r\n    }\r\n    pageNum += 1\r\n    const menuItem = $('#pc-menu').find('li.menu-item.active:first')\r\n    const alias = menuItem.data('alias') // 基础菜单的别名\r\n    const sortid = $('#sortid').val() || ''\r\n    const labelid = $('#labelid').val() || ''\r\n    const search = $('#search').val() || ''\r\n    Ajax.post('/loadCatalog',\r\n      {\r\n        pageNum,\r\n        alias,\r\n        sortid,\r\n        labelid,\r\n        search\r\n      },\r\n      Catalog.InitCatalog)\r\n  },\r\n  InitCatalog(base) {\r\n    // 属于服务内部错误\r\n    if (!base || typeof base !== 'object' || !base.data) {\r\n      return Catalog.endLoading(false, '暂无更多')\r\n    }\r\n    // 处理数据结构\r\n    const page = base.data\r\n    // 数据错误\r\n    if (!page || !Tool.isJSON(page) || !page.result || !Tool.isJSON(page.result) || page.result.length === 0) {\r\n      return Catalog.endLoading(false, '暂无更多')\r\n    }\r\n    Catalog.endLoading(true)\r\n    const list = page.result\r\n    const $data = $('#catalog-data')\r\n    for (const i in list) {\r\n      let row = Catalog.rowTemplate\r\n      const item = list[i]\r\n      let time = item.ctime // 创建时间\r\n      if (moment) {\r\n        const nowyear = moment().year()\r\n        time = moment(time, 'YYYY-MM-DD HH:mm:ss')\r\n        if (nowyear === time.year()) {\r\n          time = time.format('MM-DD HH:mm')\r\n        }\r\n      }\r\n      row = row.replace(new RegExp('{{id}}', 'g'), item.id)\r\n        .replace(new RegExp('{{title}}', 'g'), item.title)\r\n        .replace(new RegExp('{{content}}', 'g'), item.content)\r\n        .replace(new RegExp('{{sortname}}', 'g'), item.sortname)\r\n        .replace(new RegExp('{{time}}', 'g'), time)\r\n      const cover = item.cover // 图片\r\n      let img = ''\r\n      if (cover) {\r\n        img = Catalog.imgTemplate\r\n        img = img.replace(new RegExp('{{cover}}', 'g'), cover)\r\n      }\r\n      row = row.replace(new RegExp('{{img}}', 'g'), img)\r\n      const commons = item.commons // 标签\r\n      let label = ''\r\n      if (commons && commons.length > 0) {\r\n        label = Catalog.labelTemplate\r\n        let tags = ''\r\n        for (const z in commons) {\r\n          let tag = Catalog.tagsTemplate\r\n          tag = tag.replace(new RegExp('{{tagName}}', 'g'), commons[z].name)\r\n          tags += tag\r\n        }\r\n        label = label.replace(new RegExp('{{tags}}', 'g'), tags)\r\n      }\r\n      row = row.replace(new RegExp('{{label}}', 'g'), label)\r\n      $(row).appendTo($data).initUI()\r\n    }\r\n    delete page.result\r\n    page.pageNum = page.pageNum > 0 ? page.pageNum - 1 : 0\r\n    $data.data(page)\r\n    if ($('#ContentTotal').length !== 0) {\r\n      $('#ContentTotal').text(page.total || 0)\r\n    }\r\n  }\r\n}\r\n\r\nexport default Catalog\r\n"],"names":["Catalog","rowTemplate","imgTemplate","labelTemplate","tagsTemplate","init","loadData","$","window","on","windowHeight","height","scrollTop","docHeight","document","length","addLoading","setTimeout","text","loadingTemplate","$data","$loading","appendTo","offset","endLoading","has","remove","data","pageNum","pages","menuItem","find","alias","sortid","val","labelid","search","Ajax","post","InitCatalog","base","page","Tool","isJSON","result","list","i","row","item","time","ctime","moment","nowyear","year","format","replace","RegExp","id","title","content","sortname","cover","img","commons","label","tags","z","tag","name","initUI","total"],"mappings":"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"}