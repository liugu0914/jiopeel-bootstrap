{"version":3,"file":"zoom.js","sources":["../src/zoom.js"],"sourcesContent":["import $ from 'jquery'\n\nconst NAME = 'zoom'\nconst VERSION = '1.0.0'\nconst DATA_KEY = 'lyc.zoom'\nconst EVENT_KEY = `.${DATA_KEY}`\nlet element = null\n\nconst Defaults = {\n  styles: {\n    zoomImage: {\n      position: 'absolute',\n      transition: 'transform 300ms',\n      transform: 'translate3d(0, 0, 0) scale(1)',\n      transformOrigin: 'center center',\n      willChange: 'transform, top, left'\n    },\n    zoomContainer: {\n      position: 'fixed',\n      top: 0,\n      right: 0,\n      bottom: 0,\n      left: 0,\n      zIndex: 1024\n    },\n    overlay: {\n      position: 'absolute',\n      top: 0,\n      right: 0,\n      bottom: 0,\n      left: 0,\n      backgroundColor: '#313a46',\n      opacity: 0.7,\n      transition: 'opacity 300ms'\n    },\n    btn: {\n      position: 'absolute',\n      bottom: 12,\n      right: 12,\n      padding: '4px 10px',\n      border: '1px solid #e9e9e9',\n      borderRadius: 2,\n      fontSize: 12,\n      color: '#999'\n    },\n    btnHover: {\n      color: '#666'\n    }\n  }\n}\n\nconst Event = {\n  CLICK_ZOOM_IN: `click.in${EVENT_KEY}`,\n  CLICK_ZOOM_OUT: `click.out${EVENT_KEY}`,\n  RESIZE: `resize${EVENT_KEY}`,\n  SCROLL: `scroll${EVENT_KEY}`\n}\n\nconst Selector = {\n  zoomImg: 'zoom-img'\n}\n\n/**\n *  图片缩放\n *  @author lyc\n *  @date 2020年9月5日15:52:12\n */\nclass Zoom {\n  constructor(element) {\n    this._element = element\n    this.zoomTimer = null\n    this.init()\n    return this\n  }\n\n  static get NAME() {\n    return NAME\n  }\n\n  static get VERSION() {\n    return VERSION\n  }\n\n  static get element() {\n    return element\n  }\n\n  static set element(ele) {\n    element = ele\n  }\n\n  init() {\n    let zoom = $(`#${Selector.zoomImg}`)\n    if (zoom.length === 0) {\n      zoom = $(`<div id=\"${Selector.zoomImg}\"/>`).appendTo('body')\n    }\n    $(this._element).css({\n      cursor: 'zoom-in'\n    })\n    $(this._element).on(Event.CLICK_ZOOM_IN, this.zoomIn())\n    zoom.on(Event.CLICK_ZOOM_OUT, this.zoomOut())\n  }\n\n  zoomIn() {\n    return () => {\n      Zoom.element = this._element\n      const $wrap = $('<div />')\n      $wrap.css(Defaults.styles.zoomContainer)\n\n      const $overlay = $('<div class=\"overlay\" />')\n      $overlay.css(Defaults.styles.overlay)\n      const $img = $(this._element).clone()\n      $img.css(Zoom.getImageStyle(this._element, false))\n\n      const $btn = $('<a target=\"_blank\" />')\n      $btn.attr('href', $img.attr('src')).text('查看原图')\n      $btn.css(Defaults.styles.btn)\n\n      $btn.hover(function () {\n        $(this).css(Defaults.styles.btnHover)\n      }, function () {\n        $(this).css(Defaults.styles.btn)\n      })\n\n      $wrap.append($overlay).append($img).append($btn)\n      const zoom = $(`#${Selector.zoomImg}`)\n      zoom.append($wrap)\n\n      // transition\n      $img.css(Zoom.getImageStyle($img.get(0), true))\n    }\n  }\n\n  zoomOut() {\n    return (event) => {\n      // 点击的是图片retrun\n      if (event.target.nodeName === 'IMG') {\n        return\n      }\n      const $zoom = $(`#${Selector.zoomImg}`)\n      $zoom.find('img').css(Zoom.getImageStyle(this._element, false))\n      $zoom.find('.overlay').css({\n        opacity: 0\n      })\n\n      if (this.zoomTimer) {\n        clearTimeout(this.zoomTimer)\n      }\n      const n = 150\n      this.zoomTimer = setTimeout(() => {\n        $zoom.html('')\n      }, n)\n    }\n  }\n\n  static getImageStyle(image, isZoom) {\n    const imageOffset = image.getBoundingClientRect()\n    const top = imageOffset.top\n    const left = imageOffset.left\n    const width = image.width\n    const height = image.height\n\n    const style = {\n      top,\n      left,\n      width,\n      height\n    }\n\n    if (!isZoom) {\n      return Object.assign({}, Defaults.styles.zoomImage, style)\n    }\n    const two = 2\n    // Get the the coords for center of the viewport\n    const viewportX = window.innerWidth / two\n    const viewportY = window.innerHeight / two\n\n    // Get the coords for center of the original image\n    const imageCenterX = imageOffset.left + image.width / two\n    const imageCenterY = imageOffset.top + image.height / two\n\n    // Get offset amounts for image coords to be centered on screen\n    const translateX = viewportX - imageCenterX\n    const translateY = viewportY - imageCenterY\n\n    // Figure out how much to scale the image so it doesn't overflow the screen\n    const scale = Zoom.getScale(width, height)\n\n    const zoomStyle = {\n      transform: `translate3d(${translateX}px, ${translateY}px, 0) scale(${scale})`\n    }\n\n    return Object.assign({}, Defaults.styles.zoomImage, style, zoomStyle)\n  }\n\n  static getScale(width, height) {\n    const totalMargin = 40\n    const scaleX = window.innerWidth / (width + totalMargin)\n    const scaleY = window.innerHeight / (height + totalMargin)\n    return Math.min(scaleX, scaleY)\n  }\n}\n\nexport default Zoom\n"],"names":["NAME","VERSION","DATA_KEY","EVENT_KEY","element","Defaults","styles","zoomImage","position","transition","transform","transformOrigin","willChange","zoomContainer","top","right","bottom","left","zIndex","overlay","backgroundColor","opacity","btn","padding","border","borderRadius","fontSize","color","btnHover","Event","CLICK_ZOOM_IN","CLICK_ZOOM_OUT","RESIZE","SCROLL","Selector","zoomImg","Zoom","_element","zoomTimer","init","zoom","$","length","appendTo","css","cursor","on","zoomIn","zoomOut","$wrap","$overlay","$img","clone","getImageStyle","$btn","attr","text","hover","append","get","event","target","nodeName","$zoom","find","clearTimeout","n","setTimeout","html","image","isZoom","imageOffset","getBoundingClientRect","width","height","style","Object","assign","two","viewportX","window","innerWidth","viewportY","innerHeight","imageCenterX","imageCenterY","translateX","translateY","scale","getScale","zoomStyle","totalMargin","scaleX","scaleY","Math","min","ele"],"mappings":"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"}