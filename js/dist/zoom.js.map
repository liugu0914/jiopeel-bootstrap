{"version":3,"file":"zoom.js","sources":["../src/zoom.js"],"sourcesContent":["import $ from 'jquery'\n\nconst NAME = 'zoom'\nconst VERSION = '1.0.0'\nconst DATA_KEY = 'lyc.zoom'\nconst EVENT_KEY = `.${DATA_KEY}`\nlet element = null\n\nconst Defaults = {\n  styles: {\n    zoomImage: {\n      position: 'absolute',\n      transition: 'transform 300ms',\n      transform: 'translate3d(0, 0, 0) scale(1)',\n      transformOrigin: 'center center',\n      willChange: 'transform, top, left'\n    },\n    zoomContainer: {\n      position: 'fixed',\n      top: 0,\n      right: 0,\n      bottom: 0,\n      left: 0,\n      zIndex: 1024\n    },\n    overlay: {\n      position: 'absolute',\n      top: 0,\n      right: 0,\n      bottom: 0,\n      left: 0,\n      backgroundColor: '#313a46',\n      opacity: 0.7,\n      transition: 'opacity 300ms'\n    },\n    btn: {\n      position: 'absolute',\n      bottom: 12,\n      right: 12,\n      padding: '4px 10px',\n      border: '1px solid #e9e9e9',\n      borderRadius: 2,\n      fontSize: 12,\n      color: '#999'\n    },\n    btnHover: {\n      color: '#666'\n    }\n  }\n}\n\nconst Event = {\n  CLICK_ZOOM_IN: `click.in${EVENT_KEY}`,\n  CLICK_ZOOM_OUT: `click.out${EVENT_KEY}`,\n  RESIZE: `resize${EVENT_KEY}`,\n  SCROLL: `scroll${EVENT_KEY}`\n}\n\nconst Selector = {\n  zoomImg: 'zoom-img',\n  modalOpen: 'modal-open'\n}\n\n/**\n *  图片缩放\n *  @author lyc\n *  @date 2020年9月5日15:52:12\n */\nclass Zoom {\n  constructor(element) {\n    this._element = element\n    this.zoomTimer = null\n    this.init()\n    return this\n  }\n\n  static get NAME() {\n    return NAME\n  }\n\n  static get VERSION() {\n    return VERSION\n  }\n\n  static get element() {\n    return element\n  }\n\n  static set element(ele) {\n    element = ele\n  }\n\n  init() {\n    let zoom = $(`#${Selector.zoomImg}`)\n    if (zoom.length === 0) {\n      zoom = $(`<div id=\"${Selector.zoomImg}\"/>`).appendTo('body')\n    }\n    $(this._element).css({\n      cursor: 'zoom-in'\n    })\n    $(this._element).on(Event.CLICK_ZOOM_IN, this.zoomIn())\n    zoom.on(Event.CLICK_ZOOM_OUT, this.zoomOut())\n  }\n\n  zoomIn() {\n    return () => {\n      Zoom.element = this._element\n      const $wrap = $('<div />')\n      $wrap.css(Defaults.styles.zoomContainer)\n\n      const $overlay = $('<div class=\"overlay\" />')\n      $overlay.css(Defaults.styles.overlay)\n      const $img = $(`<img src=\"${this._element.src}\"/>`)\n      $img.css({\n        cursor: 'default'\n      })\n      $img.css(Zoom.getImageStyle(this._element, false))\n\n      const $btn = $('<a target=\"_blank\" />')\n      $btn.attr('href', $img.attr('src')).text('查看原图')\n      $btn.css(Defaults.styles.btn)\n\n      $btn.hover(function () {\n        $(this).css(Defaults.styles.btnHover)\n      }, function () {\n        $(this).css(Defaults.styles.btn)\n      })\n\n      $wrap.append($overlay).append($img).append($btn)\n      const zoom = $(`#${Selector.zoomImg}`)\n      zoom.append($wrap)\n\n      // transition\n      $img.css(Zoom.getImageStyle($img.get(0), true))\n\n      $('body').addClass(Selector.modalOpen)\n    }\n  }\n\n  zoomOut() {\n    return (event) => {\n      // 点击的是图片retrun\n      if (event.target.nodeName === 'IMG') {\n        return\n      }\n      const $zoom = $(`#${Selector.zoomImg}`)\n      $zoom.find('img').css(Zoom.getImageStyle(this._element, false))\n      $zoom.find('.overlay').css({\n        opacity: 0\n      })\n\n      if (this.zoomTimer) {\n        clearTimeout(this.zoomTimer)\n      }\n      const n = 150\n      this.zoomTimer = setTimeout(() => {\n        $zoom.html('')\n      }, n)\n      if ($('body').hasClass(Selector.modalOpen)) {\n        $('body').removeClass(Selector.modalOpen)\n      }\n    }\n  }\n\n  static getImageStyle(image, isZoom) {\n    const imageOffset = image.getBoundingClientRect()\n    const top = imageOffset.top\n    const left = imageOffset.left\n    const width = image.width\n    const height = image.height\n\n    const style = {\n      top,\n      left,\n      width,\n      height\n    }\n\n    if (!isZoom) {\n      return Object.assign({}, Defaults.styles.zoomImage, style)\n    }\n\n    style.width = image.naturalWidth\n    style.height = image.naturalHeight\n    const two = 2\n    // Get the the coords for center of the viewport\n    const viewportX = window.innerWidth / two\n    const viewportY = window.innerHeight / two\n\n    // Get the coords for center of the original image\n    const imageCenterX = imageOffset.left + image.width / two\n    const imageCenterY = imageOffset.top + image.height / two\n\n    // Get offset amounts for image coords to be centered on screen\n    const translateX = viewportX - imageCenterX\n    const translateY = viewportY - imageCenterY\n\n    // Figure out how much to scale the image so it doesn't overflow the screen\n    const scale = Zoom.getScale(width, height)\n\n    const zoomStyle = {\n      transform: `translate3d(${translateX}px, ${translateY}px, 0) scale(${scale})`\n    }\n\n    return Object.assign({}, Defaults.styles.zoomImage, style, zoomStyle)\n  }\n\n  static getScale(width, height) {\n    const totalMargin = 10\n    const scaleX = window.innerWidth / (width + totalMargin)\n    const scaleY = window.innerHeight / (height + totalMargin)\n    return Math.min(scaleX, scaleY)\n  }\n}\n\nexport default Zoom\n"],"names":["NAME","VERSION","DATA_KEY","EVENT_KEY","element","Defaults","styles","zoomImage","position","transition","transform","transformOrigin","willChange","zoomContainer","top","right","bottom","left","zIndex","overlay","backgroundColor","opacity","btn","padding","border","borderRadius","fontSize","color","btnHover","Event","CLICK_ZOOM_IN","CLICK_ZOOM_OUT","RESIZE","SCROLL","Selector","zoomImg","modalOpen","Zoom","_element","zoomTimer","init","zoom","$","length","appendTo","css","cursor","on","zoomIn","zoomOut","$wrap","$overlay","$img","src","getImageStyle","$btn","attr","text","hover","append","get","addClass","event","target","nodeName","$zoom","find","clearTimeout","n","setTimeout","html","hasClass","removeClass","image","isZoom","imageOffset","getBoundingClientRect","width","height","style","Object","assign","naturalWidth","naturalHeight","two","viewportX","window","innerWidth","viewportY","innerHeight","imageCenterX","imageCenterY","translateX","translateY","scale","getScale","zoomStyle","totalMargin","scaleX","scaleY","Math","min","ele"],"mappings":"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"}