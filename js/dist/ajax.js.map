{"version":3,"file":"ajax.js","sources":["../src/ajax.js"],"sourcesContent":["import $ from 'jquery'\nimport Toast from './toast'\nimport Tool from './tool'\n\nconst NAME = 'ajax'\nconst VERSION = '1.0.0'\nconst POST = 'post'\nconst GET = 'get'\nconst JSON = 'json'\nconst HTML = 'html'\nconst ONE_DAY = 86400000\nconst APPLICATION_JSON = 'application/json;charset=utf-8'\nconst APPLICATION_X_WWW_FORM_URLENCODED = 'application/x-www-form-urlencoded;charset=utf-8'\nconst MULTIPART_FORM_DATA = 'multipart/form-data;charset=utf-8'\n\nclass Ajax {\n  static get VERSION() {\n    return VERSION\n  }\n\n  static get NAME() {\n    return NAME\n  }\n\n  static get POST() {\n    return POST\n  }\n\n  static get GET() {\n    return GET\n  }\n\n  static get JSON() {\n    return JSON\n  }\n\n  static get HTML() {\n    return HTML\n  }\n\n  static get APPLICATION_JSON() {\n    return APPLICATION_JSON\n  }\n\n  static get APPLICATION_X_WWW_FORM_URLENCODED() {\n    return APPLICATION_X_WWW_FORM_URLENCODED\n  }\n\n  static get MULTIPART_FORM_DATA() {\n    return MULTIPART_FORM_DATA\n  }\n  static post(url, data, suc, err) {\n    const settings = {\n      url,\n      data: data || {},\n      type: POST,\n      success: suc,\n      error: err,\n      dataType: JSON\n    }\n    this.send(settings)\n  }\n  static get(url, data, suc, err) {\n    const settings = {\n      url,\n      data: data || {},\n      type: GET,\n      success: suc,\n      error: err,\n      dataType: JSON\n    }\n    this.send(settings)\n  }\n\n  static postHTML(url, data, suc, err) {\n    const settings = {\n      url,\n      data: data || {},\n      type: POST,\n      success: suc,\n      error: err,\n      dataType: HTML\n    }\n    this.send(settings)\n  }\n\n  static getHTML(url, data, suc, err) {\n    const settings = {\n      url,\n      data: data || {},\n      type: GET,\n      success: suc,\n      error: err,\n      dataType: HTML\n    }\n    this.send(settings)\n  }\n\n  static postJSON(url, data, suc, err) {\n    const settings = {\n      url,\n      data: data || {},\n      type: POST,\n      contentType: APPLICATION_JSON,\n      success: suc,\n      error: err,\n      dataType: JSON\n    }\n    this.send(settings)\n  }\n\n  static getJSON(url, data, suc, err) {\n    const settings = {\n      url,\n      data: data || {},\n      type: GET,\n      contentType: APPLICATION_JSON,\n      success: suc,\n      error: err,\n      dataType: JSON\n    }\n    this.send(settings)\n  }\n\n  static postJSONHTML(url, data, suc, err) {\n    const settings = {\n      url,\n      data: data || {},\n      type: POST,\n      contentType: APPLICATION_JSON,\n      success: suc,\n      error: err,\n      dataType: HTML\n    }\n    this.send(settings)\n  }\n\n  static getJSONHTML(url, data, suc, err) {\n    const settings = {\n      url,\n      data: data || {},\n      type: GET,\n      contentType: APPLICATION_JSON,\n      success: suc,\n      error: err,\n      dataType: HTML\n    }\n    this.send(settings)\n  }\n\n  static send(op) {\n    // 默认同步请求\n    const settings = {\n      type: POST,\n      async: false,\n      contentType: APPLICATION_X_WWW_FORM_URLENCODED,\n      dataType: JSON,\n      data: {},\n      headers: {\n        ajax: NAME\n      },\n      success: this.success,\n      error: this.error(op)\n    }\n    delete op.error\n    if (!op.success) {\n      delete op.success\n    }\n    op = typeof op === 'object' && op ? op : {}\n    const opData = typeof op.data === 'object' && op.data ? op.data : {}\n    let nData\n    if (opData instanceof Object) {\n      nData = {}\n      for (const key in opData) {\n        if (!key.toString().includes('.')) {\n          nData[key] = opData[key]\n        }\n      }\n    } else {\n      nData = opData\n    }\n\n    switch (op.contentType) {\n      default:\n      case APPLICATION_X_WWW_FORM_URLENCODED:\n        nData = Tool.toSerialize(nData)\n        break\n      case MULTIPART_FORM_DATA:\n        break\n      case APPLICATION_JSON:\n        nData = window.JSON.stringify(nData)\n        break\n    }\n    op.data = nData\n    op = {\n      ...settings,\n      ...op\n    }\n    $.ajax(op)\n  }\n\n  static success(result) {\n    if (!result || typeof result !== 'object') {\n      return Toast.err('未知错误')\n    }\n    if (result.result) {\n      return Toast.suc(result.message)\n    }\n    return Toast.err(result.message)\n  }\n\n  static error(op) {\n    const err = op.error\n    return function (XMLHttpRequest) {\n      let errMsg = '未知错误'\n      if (XMLHttpRequest && XMLHttpRequest.responseText) {\n        const responseText = XMLHttpRequest.responseText\n        if (Tool.isJSON(responseText)) {\n          errMsg = window.JSON.parse(responseText).message\n        } else {\n          errMsg = responseText\n          // 页面的请求错误\n          if (op.dataType === HTML) {\n            return op.success(errMsg)\n          }\n        }\n      }\n      if (err && typeof err === 'function') {\n        err(XMLHttpRequest)\n      }\n      return Toast.err(errMsg)\n    }\n  }\n\n  static setCookie(key, value, exdays) {\n    let expires = ''\n    if (exdays) {\n      const d = new Date()\n      d.setTime(d.getTime() + exdays * ONE_DAY)// 有效期一天\n      expires = `expires=${d.toUTCString()}`\n    }\n    document.cookie = `${key}=${value};${expires};path=/`\n  }\n\n  static getCookie(cname) {\n    const name = `${cname}=`\n    const decodedCookie = decodeURIComponent(document.cookie)\n    const ca = decodedCookie.split(';')\n    for (let i = 0; i < ca.length; i++) {\n      let c = ca[i]\n      while (c.charAt(0) === ' ') {\n        c = c.substring(1)\n      }\n      if (c.indexOf(name) === 0) {\n        return c.substring(name.length, c.length)\n      }\n    }\n    return ''\n  }\n}\n\nexport default Ajax\n"],"names":["NAME","VERSION","POST","GET","JSON","HTML","ONE_DAY","APPLICATION_JSON","APPLICATION_X_WWW_FORM_URLENCODED","MULTIPART_FORM_DATA","Ajax","post","url","data","suc","err","settings","type","success","error","dataType","send","get","postHTML","getHTML","postJSON","contentType","getJSON","postJSONHTML","getJSONHTML","op","async","headers","ajax","opData","nData","Object","key","toString","includes","Tool","toSerialize","window","stringify","$","result","Toast","message","XMLHttpRequest","errMsg","responseText","isJSON","parse","setCookie","value","exdays","expires","d","Date","setTime","getTime","toUTCString","document","cookie","getCookie","cname","name","decodedCookie","decodeURIComponent","ca","split","i","length","c","charAt","substring","indexOf"],"mappings":"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"}