{"version":3,"file":"editor.js","sources":["../src/editor.js"],"sourcesContent":["import Ajax from './ajax'\n\nconst NAME = 'edior'\nconst VERSION = '21.0.0'\nconst UPLOAD_URL = 'http://127.0.0.1/file/upload'\nconst FILENAME = 'file'\n\n\nclass Editor {\n  constructor(element) {\n    this._element = null\n    this.editor = null\n    this.init(element)\n    return this\n  }\n\n  static get NAME() {\n    return NAME\n  }\n\n  static get VERSION() {\n    return `CKEditor 5 version : ${VERSION}`\n  }\n\n  static MyCustomUploadAdapterPlugin(editor) {\n    editor.plugins.get('FileRepository').createUploadAdapter = (loader) =>\n      // Configure the URL to the upload script in your back-end here!\n      new EditorPlugin(loader)\n  }\n\n  init(selector) {\n    // eslint-disable-next-line no-undef\n    if (!ClassicEditor) {\n      throw new ReferenceError(`CKEditor 5  is not load! need version:${VERSION}, plz chk out`)\n    }\n    this._element = typeof selector === 'string' ? document.querySelector(selector) : selector\n    // eslint-disable-next-line no-undef\n    return ClassicEditor\n      .create(this._element, {\n        extraPlugins: [Editor.MyCustomUploadAdapterPlugin],\n        language: 'zh-cn',\n        toolbar: {\n          viewportTopOffset: this.getViewportTopOffsetConfig()\n        }\n      }).then((editor) => {\n        this.editor = editor // Save for later use.\n        // 赋值\n        if (this._element.value && !this.getData()) {\n          this.setData(this._element.value)\n        }\n        editor.model.document.on('change:data', () => {\n          this.setItem(this.getData())\n        })\n      }).catch((error) => {\n        // eslint-disable-next-line no-console\n        console.log(error)\n      })\n  }\n\n  getViewportTopOffsetConfig() {\n    const documentElement = document.documentElement\n    // eslint-disable-next-line radix\n    return parseInt(window.getComputedStyle(documentElement).getPropertyValue('--ck-viewport-top-offset'))\n  }\n\n  getData() {\n    return this.editor.getData()\n  }\n\n  setData(html) {\n    this.editor.setData(html)\n  }\n  setItem(html) {\n    this._element.value = html\n  }\n}\n\nclass EditorPlugin {\n  constructor(loader) {\n    // The file loader instance to use during the upload.\n    this.loader = loader\n    this.uploadUrl = UPLOAD_URL\n  }\n\n  static get NAME() {\n    return NAME\n  }\n\n  static get VERSION() {\n    return `CKEditor 5 version : ${VERSION}`\n  }\n\n  upload() {\n    return this.loader.file\n      .then((file) => new Promise((resolve, reject) => {\n        this._initRequest()\n        this._initListeners(resolve, reject, file)\n        this._sendRequest(file)\n      }))\n  }\n\n  // Aborts the upload process.\n  abort() {\n    if (this.xhr) {\n      this.xhr.abort()\n    }\n  }\n\n  // Initializes the XMLHttpRequest object using the URL passed to the constructor.\n  _initRequest() {\n    this.xhr = new XMLHttpRequest()\n    const xhr = this.xhr\n    // Note that your request may look different. It is up to you and your editor\n    // integration to choose the right communication channel. This example uses\n    // a POST request with JSON as a data structure but your configuration\n    // could be different.\n    xhr.open(Ajax.POST, this.uploadUrl, true)\n    xhr.responseType = Ajax.JSON\n  }\n\n  // Initializes XMLHttpRequest listeners.\n  _initListeners(resolve, reject, file) {\n    const xhr = this.xhr\n    const loader = this.loader\n    const genericErrorText = `Couldn't upload file: ${file.name}.`\n\n    xhr.addEventListener('error', () => reject(genericErrorText))\n    xhr.addEventListener('abort', () => reject())\n    xhr.addEventListener('load', () => {\n      const response = xhr.response\n      // This example assumes the XHR server's \"response\" object will come with\n      // an \"error\" which has its own \"message\" that can be passed to reject()\n      // in the upload promise.\n      //\n      // Your integration may handle upload errors in a different way so make sure\n      // it is done properly. The reject() function must be called when the upload fails.\n      if (!response || response.error) {\n        return reject(response && response.error ? response.error.message : genericErrorText)\n      }\n      // 成功回调处理\n      const data = response.data\n      // If the upload is successful, resolve the upload promise with an object containing\n      // at least the \"default\" URL, pointing to the image on the server.\n      // This URL will be used to display the image in the content. Learn more in the\n      // UploadAdapter#upload documentation.\n      return resolve({\n        default: data.url\n      })\n    })\n\n    // Upload progress when it is supported. The file loader has the #uploadTotal and #uploaded\n    // properties which are used e.g. to display the upload progress bar in the editor\n    // user interface.\n    if (xhr.upload) {\n      xhr.upload.addEventListener('progress', (evt) => {\n        if (evt.lengthComputable) {\n          loader.uploadTotal = evt.total\n          loader.uploaded = evt.loaded\n        }\n      })\n    }\n  }\n\n  // Prepares the data and sends the request.\n  _sendRequest(file) {\n    // Prepare the form data.\n    const data = new FormData()\n\n    data.append(FILENAME, file)\n\n    // Important note: This is the right place to implement security mechanisms\n    // like authentication and CSRF protection. For instance, you can use\n    // XMLHttpRequest.setRequestHeader() to set the request headers containing\n    // the CSRF token generated earlier by your application.\n\n    // Send the request.\n    this.xhr.send(data)\n  }\n}\n\nexport default Editor\n"],"names":["NAME","VERSION","UPLOAD_URL","FILENAME","Editor","element","_element","editor","init","MyCustomUploadAdapterPlugin","plugins","get","createUploadAdapter","loader","EditorPlugin","selector","ClassicEditor","ReferenceError","document","querySelector","create","extraPlugins","language","toolbar","viewportTopOffset","getViewportTopOffsetConfig","then","value","getData","setData","model","on","setItem","catch","error","console","log","documentElement","parseInt","window","getComputedStyle","getPropertyValue","html","uploadUrl","upload","file","Promise","resolve","reject","_initRequest","_initListeners","_sendRequest","abort","xhr","XMLHttpRequest","open","Ajax","POST","responseType","JSON","genericErrorText","name","addEventListener","response","message","data","default","url","evt","lengthComputable","uploadTotal","total","uploaded","loaded","FormData","append","send"],"mappings":"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"}